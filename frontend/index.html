<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sift - Email Intelligence Extraction</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container" style="display: grid; grid-template-columns: 1fr auto auto; gap: 20px; align-items: center;">
            <div class="header-content">
                <h1>üìß Sift</h1>
                <p class="subtitle">Email Intelligence Extraction & Analysis</p>
            </div>
            <div class="header-model-selector" style="min-width: 300px; background: rgba(255, 255, 255, 0.1); padding: 12px 15px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.2);">
                <label style="font-weight: 600; color: white; font-size: 0.9em; margin-bottom: 5px; display: block;">
                    LLM Model <span style="font-weight: 400; font-size: 0.85em; color: rgba(255, 255, 255, 0.8);">(affects all AI operations)</span>
                </label>
                <select id="model-select" onchange="switchModel()"
                        style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95em; background: white;">
                    <option value="">Loading models...</option>
                </select>
            </div>
            <div class="header-status" id="header-status">
                <span id="backend-status" class="status-badge loading">Connecting...</span>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- ========== PAGE 1: UPLOAD ========== -->
        <section id="upload-page" class="page active">
            <div class="page-content">
                <h2>Upload or Select PST File</h2>
                <p class="help-text">Upload a new Outlook PST file or select a previously uploaded file. Supports files up to 10GB.</p>

                <!-- Resume Pipeline Section (PROMINENTLY FIRST) -->
                <div id="pipeline-resume-section" style="display: none; margin-bottom: 30px; padding: 20px; border: 3px solid #28a745; border-radius: 8px; background-color: #f0fdf4; box-shadow: 0 4px 6px rgba(40, 167, 69, 0.1);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <span style="font-size: 32px;">‚èÆÔ∏è</span>
                        <h3 style="color: #28a745; margin: 0; flex-grow: 1;">Resume Previous Analysis</h3>
                    </div>
                    <p id="resume-message" style="margin: 10px 0; font-size: 1em; color: #333;"></p>
                    <p id="resume-stats" style="margin: 10px 0; font-size: 0.95em; color: #666; font-weight: 500;"></p>
                    <div class="button-group" style="margin-top: 20px; gap: 10px;">
                        <input type="hidden" id="resume-stage" value="">
                        <button class="btn btn-success" onclick="resumePipeline(document.getElementById('resume-stage').value)" style="font-weight: bold; font-size: 1.05em; padding: 12px 24px;">
                            Continue Analysis ‚Üí
                        </button>
                        <button class="btn btn-outline-secondary" onclick="toggleResumeOptions()" style="font-size: 1em; padding: 10px 20px;">
                            Start Fresh Instead
                        </button>
                    </div>
                </div>

                <!-- New Analysis Confirmation (shown when dismissing resume) -->
                <div id="new-analysis-confirm" style="display: none; margin-bottom: 30px; padding: 15px; border: 1px solid #ffc107; border-radius: 5px; background-color: #fffbf0;">
                    <p style="margin: 0; color: #856404;">
                        <strong>‚ö†Ô∏è Starting fresh analysis will:</strong><br>
                        ‚Ä¢ Parse the PST file again<br>
                        ‚Ä¢ Replace any existing parsed messages (unless you uncheck "Clear database")<br>
                        <span id="existing-enrichment-warning" style="display: none;">‚Ä¢ Discard previously enriched data</span>
                    </p>
                    <button class="btn btn-secondary btn-small" onclick="toggleResumeOptions()" style="margin-top: 10px;">
                        Back to Resume Option
                    </button>
                </div>

                <!-- Existing Files Selection -->
                <div id="existing-files-section" style="margin-bottom: 30px; display: none;">
                    <h3>Recently Uploaded Files</h3>
                    <div id="existing-files-list" class="form-group">
                        <!-- Files will be populated here -->
                    </div>
                </div>

                <!-- Upload Zone -->
                <div class="upload-zone" id="upload-zone">
                    <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    <h3>Drag & drop your PST file here</h3>
                    <p>or click to select from computer</p>
                    <input type="file" id="file-input" accept=".pst" style="display: none;">
                </div>

                <!-- File Info -->
                <div id="file-info" class="file-info" style="display: none;">
                    <div class="file-details">
                        <span class="file-name" id="file-name"></span>
                        <span class="file-size" id="file-size"></span>
                    </div>
                    <button type="button" class="btn-small btn-danger" onclick="clearFile()">Clear</button>
                </div>

                <!-- Upload Progress -->
                <div id="upload-progress" class="upload-progress" style="display: none;">
                    <label>Upload Progress</label>
                    <div class="progress-bar">
                        <div id="upload-bar" class="progress-fill"></div>
                    </div>
                    <p id="upload-percent">0%</p>
                </div>

                <!-- Configuration Options -->
                <div class="config-section" style="display: none;" id="config-section">
                    <h3>Configuration</h3>

                    <div class="form-group">
                        <label>Date Range</label>
                        <div class="date-range">
                            <input type="date" id="date-start" value="2000-01-01">
                            <span>to</span>
                            <input type="date" id="date-end" value="2099-12-31">
                        </div>
                        <small>Leave as-is to include all emails, or adjust to filter by date</small>
                    </div>

                    <div class="form-group">
                        <label>Minimum Conversation Messages: <span id="min-messages-value">3</span></label>
                        <input type="range" id="min-messages" min="1" max="10" value="3"
                               oninput="updateValue('min-messages-value', this.value)">
                        <small>Only analyze email threads with at least this many messages</small>
                    </div>

                    <div class="form-group">
                        <label>Maximum Messages to Process (optional)</label>
                        <input type="number" id="max-messages" placeholder="Leave empty to process all" min="1">
                        <small>Useful for testing with large files</small>
                    </div>

                    <div class="form-group">
                        <label>Spam Filter Confidence Threshold: <span id="threshold-value">80</span>%</label>
                        <input type="range" id="relevance-threshold" min="50" max="95" value="80" step="5"
                               oninput="updateValue('threshold-value', this.value)">
                        <small>Higher = more conservative (only obvious spam filtered). Lower = more aggressive filtering</small>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="clear-database" style="width: auto; margin: 0;">
                            <span>Clear existing database before parsing</span>
                        </label>
                        <small style="color: #dc3545;">‚ö†Ô∏è Warning: This will permanently delete all previously parsed messages, conversations, and enrichment data</small>
                    </div>
                </div>

                <!-- Upload Button -->
                <div class="button-group">
                    <button id="upload-pst-btn" class="btn btn-primary" onclick="uploadPSTFile()" style="display: none;">
                        Upload PST File
                    </button>
                    <button id="parse-selected-btn" class="btn btn-success" onclick="parseSelectedFile()" style="display: none;">
                        Parse Selected File
                    </button>
                </div>

                <!-- Success Message -->
                <div id="upload-success" class="alert alert-success" style="display: none;"></div>

                <!-- Error Messages -->
                <div id="upload-error" class="alert alert-danger" style="display: none;"></div>
                <div id="parse-error" class="alert alert-danger" style="display: none;"></div>
            </div>
        </section>

        <!-- ========== PAGE 2: PIPELINE DASHBOARD ========== -->
        <section id="pipeline-page" class="page">
            <div class="page-content">
                <h2>Pipeline Progress</h2>
                <p class="help-text">Monitor the progress of your email extraction pipeline.</p>

                <!-- Workflow Visualization -->
                <div class="workflow">
                    <div class="workflow-step" id="parse-step">
                        <div class="step-icon">üìÑ</div>
                        <h3>Parse</h3>
                        <p class="step-description">Extract emails from PST</p>
                    </div>
                    <div class="workflow-arrow">‚Üí</div>
                    <div class="workflow-step" id="enrich-step">
                        <div class="step-icon">üîç</div>
                        <h3>Enrich</h3>
                        <p class="step-description">Extract intelligence with LLM</p>
                    </div>
                    <div class="workflow-arrow">‚Üí</div>
                    <div class="workflow-step" id="aggregate-step">
                        <div class="step-icon">üìä</div>
                        <h3>Aggregate</h3>
                        <p class="step-description">Cluster & deduplicate</p>
                    </div>
                </div>

                <!-- Job Status Cards -->
                <div class="job-cards">
                    <!-- Parse Card -->
                    <div class="job-card" id="parse-card">
                        <h4>Parsing</h4>
                        <div class="status-badge" id="parse-status">Pending</div>
                        <p style="font-size: 0.85em; color: #666; margin-top: 8px;">
                            Using model: <strong id="parse-model-name">-</strong>
                        </p>
                        <div class="progress-bar">
                            <div id="parse-progress" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <p id="parse-info" class="job-info">Waiting to start...</p>
                        <div id="parse-error" class="alert alert-danger" style="display: none;"></div>
                        <button id="cancel-parse-btn" class="btn btn-danger btn-small" onclick="cancelJob('parse')"
                                style="display: none; margin-top: 10px;">Cancel Parsing</button>
                    </div>

                    <!-- Enrich Card -->
                    <div class="job-card" id="enrich-card">
                        <h4>Enrichment</h4>
                        <div class="status-badge" id="enrich-status">Pending</div>
                        <div class="progress-bar">
                            <div id="enrich-progress" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <p id="enrich-info" class="job-info">Waiting for parsing to complete...</p>
                        <div id="enrich-error" class="alert alert-danger" style="display: none;"></div>
                        <button id="cancel-enrich-btn" class="btn btn-danger btn-small" onclick="cancelJob('enrich')"
                                style="display: none; margin-top: 10px;">Cancel Enrichment</button>
                        <div id="enrich-config" class="enrich-config" style="display: none;">
                            <div class="form-group">
                                <label>Batch Size: <span id="batch-value">5</span></label>
                                <input type="range" id="batch-size" min="1" max="20" value="5"
                                       oninput="updateValue('batch-value', this.value)">
                            </div>
                            <p style="font-size: 0.85em; color: #666; margin-top: 10px;">
                                Using model: <strong id="enrich-model-name">-</strong>
                            </p>
                        </div>
                        <button id="start-enrich-btn" class="btn btn-primary" onclick="startEnrichment()"
                                style="display: none;">Start Enrichment</button>
                    </div>

                    <!-- Aggregate Card -->
                    <div class="job-card" id="aggregate-card">
                        <h4>Aggregation</h4>
                        <div class="status-badge" id="aggregate-status">Pending</div>
                        <p style="font-size: 0.85em; color: #999; margin-top: 8px;">
                            No LLM required
                        </p>
                        <div class="progress-bar">
                            <div id="aggregate-progress" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <p id="aggregate-info" class="job-info">Waiting for enrichment to complete...</p>
                        <div id="aggregate-error" class="alert alert-danger" style="display: none;"></div>
                        <button id="cancel-aggregate-btn" class="btn btn-danger btn-small" onclick="cancelJob('aggregate')"
                                style="display: none; margin-top: 10px;">Cancel Aggregation</button>
                        <button id="start-aggregate-btn" class="btn btn-primary" onclick="startAggregation()"
                                style="display: none;">Start Aggregation</button>
                    </div>

                    <!-- RAG Query Card -->
                    <div class="job-card" id="rag-card">
                        <h4>RAG Query</h4>
                        <div class="status-badge" id="rag-status">Pending</div>
                        <p style="font-size: 0.85em; color: #666; margin-top: 8px;">
                            Chat with your enriched email data
                        </p>
                        <div class="progress-bar" id="rag-progress-bar" style="display: none;">
                            <div id="rag-progress" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <p id="rag-info" class="job-info">Generate embeddings to enable semantic search</p>
                        <div id="rag-error" class="alert alert-danger" style="display: none;"></div>
                        <button id="start-rag-embed-btn" class="btn btn-primary" onclick="startEmbeddingGeneration()"
                                style="display: none; margin-top: 10px;">Generate Embeddings</button>
                        <button id="open-rag-chat-btn" class="btn btn-success" onclick="goToRAGChat()"
                                style="display: none; margin-top: 10px;">Start RAG Session ‚Üí</button>
                    </div>

                    <!-- REPL Explorer Card (CODE-BASED ANALYSIS) -->
                    <div class="job-card" id="repl-card" style="border: 2px solid #10b981; background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);">
                        <h4 style="color: #065f46;">REPL Explorer</h4>
                        <div class="status-badge" id="repl-status" style="background: #d1fae5; color: #065f46;">New</div>
                        <p style="font-size: 0.85em; color: #047857; margin-top: 8px;">
                            <strong>Code-based</strong> corpus exploration
                        </p>
                        <p id="repl-info" class="job-info" style="color: #065f46;">
                            Watch LLM generate Python code to analyze your emails
                        </p>
                        <p style="font-size: 0.8em; color: #059669; margin-top: 8px; padding: 8px; background: rgba(16, 185, 129, 0.1); border-radius: 4px;">
                            <strong>Tech Demo:</strong> Compare model capabilities - see how different models generate exploration code
                        </p>
                        <button id="open-repl-btn" class="btn btn-success" onclick="goToREPL()"
                                style="display: none; margin-top: 10px; font-weight: 600;">Start REPL Explorer ‚Üí</button>
                    </div>

                    <!-- Data Inspector Card -->
                    <div class="job-card" id="inspector-card" style="border: 2px solid #f59e0b; background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);">
                        <h4 style="color: #92400e;">Data Inspector</h4>
                        <div class="status-badge" id="inspector-status" style="background: #fde68a; color: #92400e;">Tool</div>
                        <p style="font-size: 0.85em; color: #b45309; margin-top: 8px;">
                            <strong>Debug</strong> enrichment quality
                        </p>
                        <p id="inspector-info" class="job-info" style="color: #92400e;">
                            Browse messages and view extraction results side-by-side
                        </p>
                        <p style="font-size: 0.8em; color: #d97706; margin-top: 8px; padding: 8px; background: rgba(245, 158, 11, 0.1); border-radius: 4px;">
                            <strong>Quality Check:</strong> Verify LLM extractions against raw email content
                        </p>
                        <button id="open-inspector-btn" class="btn" onclick="goToInspector()"
                                style="display: none; margin-top: 10px; font-weight: 600; background: #f59e0b; color: white;">Open Inspector ‚Üí</button>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="button-group">
                    <button class="btn btn-secondary" onclick="goToUpload()">‚Üê Back to Upload</button>
                    <button id="results-btn" class="btn btn-primary" onclick="goToResults()"
                            style="display: none;">View Results ‚Üí</button>
                </div>
            </div>
        </section>

        <!-- ========== PAGE 3: RESULTS VIEWER ========== -->
        <section id="results-page" class="page">
            <div class="page-content">
                <h2>Analysis Results</h2>

                <!-- Statistics Cards -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <h4>Total Messages</h4>
                        <p class="stat-value" id="stat-messages">-</p>
                    </div>
                    <div class="stat-card">
                        <h4>Conversations</h4>
                        <p class="stat-value" id="stat-conversations">-</p>
                    </div>
                    <div class="stat-card">
                        <h4>Projects Found</h4>
                        <p class="stat-value" id="stat-projects">-</p>
                    </div>
                    <div class="stat-card">
                        <h4>Stakeholders</h4>
                        <p class="stat-value" id="stat-stakeholders">-</p>
                    </div>
                </div>

                <!-- Tabs for Results -->
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('projects-tab')">Projects</button>
                    <button class="tab-btn" onclick="switchTab('stakeholders-tab')">Stakeholders</button>
                    <button class="tab-btn" onclick="switchTab('downloads-tab')">Downloads</button>
                </div>

                <!-- Projects Tab -->
                <div id="projects-tab" class="tab-content active">
                    <h3>Identified Projects</h3>
                    <div class="table-container">
                        <table id="projects-table" class="results-table">
                            <thead>
                                <tr>
                                    <th onclick="sortTable('projects-table', 0)">Project Name</th>
                                    <th onclick="sortTable('projects-table', 1)">Mentions</th>
                                    <th onclick="sortTable('projects-table', 2)">Confidence</th>
                                    <th onclick="sortTable('projects-table', 3)">Importance</th>
                                    <th>Stakeholders</th>
                                </tr>
                            </thead>
                            <tbody id="projects-tbody">
                                <tr><td colspan="5" class="loading-message">Loading projects...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Stakeholders Tab -->
                <div id="stakeholders-tab" class="tab-content">
                    <h3>Key Stakeholders</h3>
                    <div class="table-container">
                        <table id="stakeholders-table" class="results-table">
                            <thead>
                                <tr>
                                    <th onclick="sortTable('stakeholders-table', 0)">Name</th>
                                    <th>Email</th>
                                    <th onclick="sortTable('stakeholders-table', 2)">Primary Role</th>
                                    <th onclick="sortTable('stakeholders-table', 3)">Projects</th>
                                    <th onclick="sortTable('stakeholders-table', 4)">Messages</th>
                                </tr>
                            </thead>
                            <tbody id="stakeholders-tbody">
                                <tr><td colspan="5" class="loading-message">Loading stakeholders...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Downloads Tab -->
                <div id="downloads-tab" class="tab-content">
                    <h3>Download Reports</h3>
                    <p class="help-text">Export analysis results in various formats</p>

                    <div class="downloads-grid">
                        <div class="download-item">
                            <h4>üìÑ Markdown Report</h4>
                            <p>Human-readable summary with analysis</p>
                            <button class="btn btn-secondary" onclick="downloadReport('Q4_2025_Summary.md')">
                                Download Q4_2025_Summary.md
                            </button>
                        </div>

                        <div class="download-item">
                            <h4>üìä JSON Exports</h4>
                            <p>Machine-readable structured data</p>
                            <button class="btn btn-secondary" onclick="downloadReport('aggregated_projects.json')">
                                Projects JSON
                            </button>
                            <button class="btn btn-secondary" onclick="downloadReport('aggregated_stakeholders.json')">
                                Stakeholders JSON
                            </button>
                        </div>

                        <div class="download-item">
                            <h4>üìà CSV Exports</h4>
                            <p>Import into Excel or BI tools</p>
                            <button class="btn btn-secondary" onclick="downloadReport('projects_summary.csv')">
                                Projects CSV
                            </button>
                            <button class="btn btn-secondary" onclick="downloadReport('stakeholders_summary.csv')">
                                Stakeholders CSV
                            </button>
                            <button class="btn btn-secondary" onclick="downloadReport('project_stakeholder_matrix.csv')">
                                Matrix CSV
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Aggregation Error Message -->
                <div id="aggregation-error" class="alert alert-danger" style="display: none;"></div>

                <!-- Re-run Aggregation Controls - Tabbed Interface -->
                <div id="aggregation-retry-section" style="display: none; margin-bottom: 20px; padding: 0; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9; overflow: hidden;">
                    <h4 style="padding: 15px 15px 0 15px; margin-bottom: 15px;">Aggregation Configuration</h4>
                    <p style="padding: 0 15px; margin-bottom: 15px; color: #666; font-size: 0.95em;">Modify aggregation settings and re-run without re-enriching:</p>

                    <!-- Tab Navigation -->
                    <div class="agg-settings-tabs" style="display: flex; border-bottom: 2px solid #ddd; background-color: #fff;">
                        <button type="button" class="agg-tab-btn active" data-tab="confidence" onclick="switchAggregationTab('confidence')" style="flex: 1; padding: 12px; border: none; background: none; cursor: pointer; font-weight: 500; color: #666; border-bottom: 3px solid #2563eb; transition: all 0.2s ease;">
                            Confidence & Mentions
                        </button>
                        <button type="button" class="agg-tab-btn" data-tab="filtering" onclick="switchAggregationTab('filtering')" style="flex: 1; padding: 12px; border: none; background: none; cursor: pointer; font-weight: 500; color: #666; border-bottom: 3px solid transparent; transition: all 0.2s ease;">
                            Filtering
                        </button>
                        <button type="button" class="agg-tab-btn" data-tab="deduplication" onclick="switchAggregationTab('deduplication')" style="flex: 1; padding: 12px; border: none; background: none; cursor: pointer; font-weight: 500; color: #666; border-bottom: 3px solid transparent; transition: all 0.2s ease;">
                            Deduplication
                        </button>
                        <button type="button" class="agg-tab-btn" data-tab="diagnostics" onclick="switchAggregationTab('diagnostics')" style="flex: 1; padding: 12px; border: none; background: none; cursor: pointer; font-weight: 500; color: #666; border-bottom: 3px solid transparent; transition: all 0.2s ease;">
                            Diagnostics
                        </button>
                    </div>

                    <!-- Tab Content -->
                    <div style="padding: 20px;">

                        <!-- Tab 1: Confidence & Mentions -->
                        <div id="agg-tab-confidence" class="agg-tab-pane active" style="display: block;">
                            <div class="form-group">
                                <label style="font-weight: 600; margin-bottom: 5px;">Min Role Confidence: <span id="agg-conf-value" style="color: #2563eb; font-weight: 700;">0.65</span></label>
                                <input type="range" id="agg-min-conf" min="0.5" max="0.95" step="0.05" value="0.65"
                                       oninput="updateAggregationValue('agg-conf-value', this.value)" style="width: 100%; margin-bottom: 5px;">
                                <small style="color: #666; display: block;">Exclude stakeholders with lower confidence in inferred role (0.50-0.95)</small>
                            </div>
                            <div class="form-group" style="margin-top: 20px;">
                                <label style="font-weight: 600; margin-bottom: 5px;">Min Mentions: <span id="agg-mentions-value" style="color: #2563eb; font-weight: 700;">2</span></label>
                                <input type="range" id="agg-min-mentions" min="1" max="10" value="2"
                                       oninput="updateAggregationValue('agg-mentions-value', this.value)" style="width: 100%; margin-bottom: 5px;">
                                <small style="color: #666; display: block;">Exclude stakeholders mentioned fewer times (1-10)</small>
                            </div>
                        </div>

                        <!-- Tab 2: Filtering -->
                        <div id="agg-tab-filtering" class="agg-tab-pane" style="display: none;">
                            <div class="form-group" style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                                <input type="checkbox" id="agg-exclude-generic" checked style="width: 18px; height: 18px; cursor: pointer;">
                                <label for="agg-exclude-generic" style="margin: 0; cursor: pointer; flex-grow: 1;">
                                    <strong>Exclude Generic Names</strong>
                                    <small style="display: block; color: #666; margin-top: 3px;">Filter out placeholder names like 'User', 'Admin', 'Team', 'Assistant'</small>
                                </label>
                            </div>
                            <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="agg-validate-domains" checked style="width: 18px; height: 18px; cursor: pointer;">
                                <label for="agg-validate-domains" style="margin: 0; cursor: pointer; flex-grow: 1;">
                                    <strong>Validate Email Domains</strong>
                                    <small style="display: block; color: #666; margin-top: 3px;">Remove emails with invalid or suspicious domains</small>
                                </label>
                            </div>
                        </div>

                        <!-- Tab 3: Deduplication -->
                        <div id="agg-tab-deduplication" class="agg-tab-pane" style="display: none;">
                            <div class="form-group" style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                                <input type="checkbox" id="agg-dedup-enable" checked onchange="toggleDeduplicationSlider()" style="width: 18px; height: 18px; cursor: pointer;">
                                <label for="agg-dedup-enable" style="margin: 0; cursor: pointer; flex-grow: 1;">
                                    <strong>Enable Name Deduplication</strong>
                                    <small style="display: block; color: #666; margin-top: 3px;">Merge similar stakeholder names across different conversations</small>
                                </label>
                            </div>
                            <div class="form-group" style="margin-left: 28px; opacity: 1; transition: opacity 0.2s ease;">
                                <label style="font-weight: 600; margin-bottom: 5px;">Similarity Threshold: <span id="agg-similarity-value" style="color: #2563eb; font-weight: 700;">0.80</span></label>
                                <input type="range" id="agg-similarity" min="0.5" max="1.0" step="0.05" value="0.80"
                                       oninput="updateAggregationValue('agg-similarity-value', this.value)" style="width: 100%; margin-bottom: 5px;">
                                <small style="color: #666; display: block;">Higher values = more strict matching (0.50=lenient, 1.00=exact)</small>
                            </div>
                        </div>

                        <!-- Tab 4: Diagnostics -->
                        <div id="agg-tab-diagnostics" class="agg-tab-pane" style="display: none;">
                            <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="agg-enable-diags" checked style="width: 18px; height: 18px; cursor: pointer;">
                                <label for="agg-enable-diags" style="margin: 0; cursor: pointer; flex-grow: 1;">
                                    <strong>Enable Diagnostic Reports</strong>
                                    <small style="display: block; color: #666; margin-top: 3px;">Generate detailed logs of filtering decisions and intermediate results</small>
                                </label>
                            </div>
                        </div>

                    </div>

                    <!-- Action Buttons -->
                    <div style="padding: 0 20px 20px 20px; border-top: 1px solid #ddd; display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="resetAggregationSettings()" style="margin-top: 0;">
                            Reset to Defaults
                        </button>
                        <button type="button" class="btn btn-primary" onclick="retryAggregation()" style="margin-top: 0;">
                            Re-run Aggregation with New Settings
                        </button>
                    </div>
                </div>

                <!-- Post-Aggregation Quality Filter Section -->
                <div id="post-filter-section" style="display: none; margin-bottom: 20px; padding: 0; border: 2px solid #8b5cf6; border-radius: 5px; background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); overflow: hidden; box-shadow: 0 2px 8px rgba(139, 92, 246, 0.1);">
                    <div style="padding: 20px; border-bottom: 2px solid #e9d5ff; display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 28px;">‚ú®</span>
                        <div style="flex-grow: 1;">
                            <h4 style="margin: 0 0 5px 0; color: #5b21b6;">Post-Aggregation Quality Filter</h4>
                            <p style="margin: 0; color: #7c3aed; font-size: 0.9em;">Use LLM to evaluate projects for role-based relevance and filter low-confidence results</p>
                            <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #666;">
                                Using model: <strong id="post-filter-model-name">-</strong>
                            </p>
                        </div>
                    </div>

                    <div style="padding: 20px;">
                        <div class="form-group">
                            <label style="font-weight: 600; margin-bottom: 8px;">Your Role & Responsibilities</label>
                            <textarea id="post-filter-role" placeholder="e.g., Solution Architect, responsible for PoC and MVP presales engineering and projects. Focus on cloud infrastructure, migration strategy, and technical decision-making."
                                      style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 1em; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; resize: vertical; min-height: 80px;"
                                      rows="4"></textarea>
                            <small style="color: #666; display: block; margin-top: 5px;">Describe your role and key responsibilities. The LLM will use this to evaluate project relevance.</small>
                        </div>

                        <div class="form-group" style="margin-top: 20px;">
                            <label style="font-weight: 600; margin-bottom: 8px;">Confidence Threshold: <span id="post-filter-threshold-value" style="color: #8b5cf6; font-weight: 700;">0.75</span></label>
                            <input type="range" id="post-filter-threshold" min="0.0" max="1.0" step="0.05" value="0.75"
                                   oninput="updateFilterThresholdDisplay(this.value)" style="width: 100%; margin-bottom: 8px;">
                            <small style="color: #666; display: block;">Projects below this confidence will be hidden from reports (0.00-1.00, default 0.75)</small>
                        </div>

                        <div id="post-filter-progress" style="display: none; margin-top: 15px; padding: 15px; background-color: #f0f9ff; border: 1px solid #bfdbfe; border-radius: 4px;">
                            <p style="margin: 0 0 10px 0; font-weight: 600; color: #1e40af;">Filtering projects...</p>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <div class="progress-bar" style="flex-grow: 1; height: 24px;">
                                    <div id="post-filter-progress-bar" class="progress-fill" style="width: 0%; height: 100%;"></div>
                                </div>
                                <p id="post-filter-progress-text" style="margin: 0; min-width: 60px; text-align: right; font-weight: 600; color: #1e40af;">0%</p>
                            </div>
                            <p id="post-filter-progress-message" style="margin: 10px 0 0 0; font-size: 0.9em; color: #1e40af;"></p>
                        </div>

                        <div id="post-filter-results" style="display: none; margin-top: 15px; padding: 15px; background-color: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 4px;">
                            <h5 style="margin: 0 0 10px 0; color: #166534;">Filter Complete ‚úì</h5>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                                <div style="background: white; padding: 10px; border-radius: 3px; text-align: center;">
                                    <p style="margin: 0 0 5px 0; color: #666; font-size: 0.85em;">Total Projects</p>
                                    <p style="margin: 0; font-size: 1.3em; font-weight: 700; color: #16a34a;" id="post-filter-total">-</p>
                                </div>
                                <div style="background: white; padding: 10px; border-radius: 3px; text-align: center;">
                                    <p style="margin: 0 0 5px 0; color: #666; font-size: 0.85em;">Included</p>
                                    <p style="margin: 0; font-size: 1.3em; font-weight: 700; color: #22c55e;" id="post-filter-included">-</p>
                                </div>
                                <div style="background: white; padding: 10px; border-radius: 3px; text-align: center;">
                                    <p style="margin: 0 0 5px 0; color: #666; font-size: 0.85em;">Excluded</p>
                                    <p style="margin: 0; font-size: 1.3em; font-weight: 700; color: #ef4444;" id="post-filter-excluded">-</p>
                                </div>
                            </div>
                            <p style="margin: 0 0 10px 0; color: #666; font-size: 0.9em;">Average Confidence: <strong id="post-filter-avg-conf" style="color: #8b5cf6;">-</strong></p>

                            <details style="cursor: pointer; margin-top: 15px;">
                                <summary style="font-weight: 600; color: #5b21b6; padding: 8px; background: white; border-radius: 3px; user-select: none;">View Excluded Projects & Reasoning ‚Üí</summary>
                                <div id="post-filter-excluded-list" style="margin-top: 10px; max-height: 400px; overflow-y: auto;">
                                    <!-- Excluded projects will be populated here -->
                                </div>
                            </details>
                        </div>

                        <div id="post-filter-error" class="alert alert-danger" style="display: none; margin-top: 15px;"></div>
                    </div>

                    <!-- Action Buttons -->
                    <div style="padding: 0 20px 20px 20px; border-top: 1px solid #e9d5ff; display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="togglePostFilterSection()" style="margin-top: 0;">
                            Collapse
                        </button>
                        <button type="button" id="start-post-filter-btn" class="btn btn-primary" onclick="startPostAggregationFilter()" style="margin-top: 0;">
                            Run Quality Filter
                        </button>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="button-group">
                    <button class="btn btn-secondary" onclick="goToPipeline()">‚Üê Back to Pipeline</button>
                    <button class="btn btn-primary" onclick="goToUpload()">Start New Analysis</button>
                </div>
            </div>
        </section>

        <!-- ========== PAGE 4: RAG CHAT ========== -->
        <section id="rag-page" class="page">
            <div class="page-content">
                <h2>Chat with Your Email Data</h2>
                <p class="help-text">Ask questions about projects, stakeholders, and activities. I'll search your enriched emails and provide answers with citations.</p>

                <!-- Chat Container -->
                <div id="rag-chat-container" style="background: white; border: 1px solid #ddd; border-radius: 8px; min-height: 500px; display: flex; flex-direction: column; margin-bottom: 20px;">

                    <!-- Chat Messages Area -->
                    <div id="rag-messages" style="flex: 1; padding: 20px; overflow-y: auto; max-height: 600px; background: #f9fafb;">
                        <!-- Welcome message -->
                        <div class="rag-message assistant">
                            <div class="message-avatar">ü§ñ</div>
                            <div class="message-content">
                                <p><strong>Welcome to Email Intelligence Chat!</strong></p>
                                <p>I have access to your enriched email data (projects, stakeholders, importance levels). Ask me anything!</p>
                                <p><strong>Example queries:</strong></p>
                                <ul style="margin: 10px 0; padding-left: 20px;">
                                    <li>"What projects involved cloud migration?"</li>
                                    <li>"Who were the key stakeholders in Q4?"</li>
                                    <li>"Summarize critical initiatives from December"</li>
                                    <li>"What did we decide about infrastructure?"</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Input Area -->
                    <div style="border-top: 2px solid #e5e7eb; padding: 15px; background: #f9fafb;">
                        <div style="display: flex; gap: 10px; align-items: flex-end;">
                            <textarea id="rag-query-input"
                                     placeholder="Ask a question about your emails..."
                                     style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 1em; font-family: inherit; resize: vertical; min-height: 44px; max-height: 100px;"
                                     onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendRAGQuery(); }"></textarea>
                            <button class="btn btn-primary" onclick="sendRAGQuery()" id="rag-send-btn" style="padding: 10px 24px;">
                                Send
                            </button>
                        </div>
                        <div id="rag-loading" style="display: none; margin-top: 10px; color: #666; font-size: 0.9em;">
                            <span>üîç Searching emails and generating response...</span>
                        </div>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="button-group">
                    <button class="btn btn-secondary" onclick="goToPipeline()">‚Üê Back to Pipeline</button>
                    <button class="btn btn-outline-danger" onclick="clearRAGSession()">Clear Chat & Start Fresh</button>
                </div>
            </div>
        </section>

        <!-- ========== PAGE 5: REPL EXPLORER ========== -->
        <section id="repl-page" class="page">
            <div class="page-content">
                <h2>REPL Explorer - Code-Based Analysis</h2>
                <p class="help-text">Explore your email corpus using LLM-generated Python code. Watch the model reason through your data step by step.</p>

                <!-- Corpus Stats Banner -->
                <div id="repl-corpus-stats" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border: 1px solid #bae6fd; border-radius: 8px; padding: 15px 20px; margin-bottom: 20px; display: flex; gap: 30px; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 1.5em;">üìä</span>
                        <span style="font-weight: 600; color: #0369a1;">Corpus Loaded</span>
                    </div>
                    <div style="display: flex; gap: 25px; flex-wrap: wrap;">
                        <div>
                            <span style="color: #64748b; font-size: 0.85em;">Messages</span>
                            <span id="repl-stat-messages" style="display: block; font-weight: 700; color: #0284c7; font-size: 1.2em;">-</span>
                        </div>
                        <div>
                            <span style="color: #64748b; font-size: 0.85em;">Date Range</span>
                            <span id="repl-stat-dates" style="display: block; font-weight: 700; color: #0284c7; font-size: 1.1em;">-</span>
                        </div>
                        <div>
                            <span style="color: #64748b; font-size: 0.85em;">Senders</span>
                            <span id="repl-stat-senders" style="display: block; font-weight: 700; color: #0284c7; font-size: 1.2em;">-</span>
                        </div>
                        <div>
                            <span style="color: #64748b; font-size: 0.85em;">Projects</span>
                            <span id="repl-stat-projects" style="display: block; font-weight: 700; color: #0284c7; font-size: 1.2em;">-</span>
                        </div>
                    </div>
                </div>

                <!-- Model Selector for REPL -->
                <div style="background: #fef3c7; border: 1px solid #fcd34d; border-radius: 8px; padding: 15px 20px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 1.3em;">üß†</span>
                            <span style="font-weight: 600; color: #92400e;">Code Generation Model</span>
                        </div>
                        <select id="repl-model-select" style="padding: 8px 12px; border: 1px solid #f59e0b; border-radius: 4px; font-size: 1em; min-width: 250px; background: white;">
                            <option value="">Use default model</option>
                        </select>
                        <span style="color: #b45309; font-size: 0.9em;">Model capability affects code quality - try different models to compare!</span>
                    </div>
                </div>

                <!-- Query Input -->
                <div style="background: white; border: 2px solid #10b981; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #065f46; margin-bottom: 10px; display: block;">
                        Ask a question about your emails
                    </label>
                    <div style="display: flex; gap: 10px; align-items: flex-start;">
                        <textarea id="repl-query-input"
                                  placeholder="e.g., How did my engagement with the Platform team change over Q4? / Who were my top collaborators in November? / What projects went quiet in December?"
                                  style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 1em; font-family: inherit; resize: vertical; min-height: 60px;"
                                  onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendREPLQuery(); }"></textarea>
                        <button class="btn btn-success" onclick="sendREPLQuery()" id="repl-send-btn" style="padding: 12px 24px; font-weight: 600;">
                            Explore
                        </button>
                    </div>
                    <div id="repl-loading" style="display: none; margin-top: 15px; padding: 15px; background: #f0fdf4; border-radius: 4px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="spinner" style="width: 20px; height: 20px; border: 3px solid #d1fae5; border-top-color: #10b981; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                            <span style="color: #065f46; font-weight: 500;">Generating and executing code...</span>
                        </div>
                    </div>
                </div>

                <!-- Exploration Trace Container -->
                <div id="repl-trace-container" style="display: none; background: #1e293b; border-radius: 8px; overflow: hidden; margin-bottom: 20px;">
                    <div style="background: #334155; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: #94a3b8; font-weight: 600; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px;">Exploration Trace</span>
                        <span id="repl-trace-model" style="color: #67e8f9; font-size: 0.85em;"></span>
                    </div>
                    <div id="repl-trace-steps" style="padding: 20px; max-height: 500px; overflow-y: auto;">
                        <!-- Steps will be populated dynamically -->
                    </div>
                </div>

                <!-- Answer Container -->
                <div id="repl-answer-container" style="display: none; background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border: 2px solid #10b981; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <span style="font-size: 1.5em;">‚úÖ</span>
                        <span style="font-weight: 700; color: #065f46; font-size: 1.1em;">Answer</span>
                    </div>
                    <div id="repl-answer-content" style="color: #064e3b; line-height: 1.6; white-space: pre-wrap;">
                        <!-- Answer will be populated dynamically -->
                    </div>
                </div>

                <!-- History Section -->
                <details id="repl-history-section" style="margin-bottom: 20px; display: none;">
                    <summary style="cursor: pointer; padding: 15px; background: #f1f5f9; border-radius: 8px; font-weight: 600; color: #475569;">
                        Previous Explorations in This Session
                    </summary>
                    <div id="repl-history-list" style="padding: 15px; background: #f8fafc; border-radius: 0 0 8px 8px; max-height: 300px; overflow-y: auto;">
                        <!-- History will be populated dynamically -->
                    </div>
                </details>

                <!-- Navigation -->
                <div class="button-group">
                    <button class="btn btn-secondary" onclick="goToPipeline()">‚Üê Back to Pipeline</button>
                    <button class="btn btn-primary" onclick="goToRAGChat()">Compare with RAG Chat ‚Üí</button>
                    <button class="btn btn-outline-danger" onclick="clearREPLSession()">Clear Session</button>
                </div>
            </div>
        </section>

        <!-- ========== PAGE 6: DATA INSPECTOR ========== -->
        <section id="inspector-page" class="page">
            <div class="page-content">
                <h2>Data Inspector - Enrichment Quality Review</h2>
                <p class="help-text">Browse individual messages and their LLM extractions to verify data quality.</p>

                <!-- Filter Controls -->
                <div style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 15px; align-items: end;">
                        <div>
                            <label style="font-weight: 600; font-size: 0.9em; color: #374151; display: block; margin-bottom: 5px;">Filter by Status</label>
                            <select id="inspector-filter-status" onchange="loadInspectorMessages()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="all">All Messages</option>
                                <option value="completed">Enriched (completed)</option>
                                <option value="pending">Pending</option>
                                <option value="failed">Failed</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-weight: 600; font-size: 0.9em; color: #374151; display: block; margin-bottom: 5px;">Search Subject/Sender</label>
                            <input type="text" id="inspector-search" placeholder="Type to search..."
                                   onkeyup="debounceInspectorSearch()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div>
                            <label style="font-weight: 600; font-size: 0.9em; color: #374151; display: block; margin-bottom: 5px;">Page Size</label>
                            <select id="inspector-page-size" onchange="loadInspectorMessages()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="10">10 messages</option>
                                <option value="25" selected>25 messages</option>
                                <option value="50">50 messages</option>
                                <option value="100">100 messages</option>
                            </select>
                        </div>
                        <div>
                            <button class="btn btn-secondary" onclick="loadInspectorMessages()" style="padding: 8px 16px;">
                                Refresh
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Stats Summary -->
                <div id="inspector-stats" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 20px;">
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; text-align: center;">
                        <p style="margin: 0; color: #64748b; font-size: 0.85em;">Total</p>
                        <p id="inspector-stat-total" style="margin: 5px 0 0 0; font-size: 1.5em; font-weight: 700; color: #0284c7;">-</p>
                    </div>
                    <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; text-align: center;">
                        <p style="margin: 0; color: #64748b; font-size: 0.85em;">Enriched</p>
                        <p id="inspector-stat-enriched" style="margin: 5px 0 0 0; font-size: 1.5em; font-weight: 700; color: #16a34a;">-</p>
                    </div>
                    <div style="background: #fef3c7; padding: 15px; border-radius: 8px; text-align: center;">
                        <p style="margin: 0; color: #64748b; font-size: 0.85em;">Pending</p>
                        <p id="inspector-stat-pending" style="margin: 5px 0 0 0; font-size: 1.5em; font-weight: 700; color: #d97706;">-</p>
                    </div>
                    <div style="background: #fef2f2; padding: 15px; border-radius: 8px; text-align: center;">
                        <p style="margin: 0; color: #64748b; font-size: 0.85em;">Failed</p>
                        <p id="inspector-stat-failed" style="margin: 5px 0 0 0; font-size: 1.5em; font-weight: 700; color: #dc2626;">-</p>
                    </div>
                    <div style="background: #faf5ff; padding: 15px; border-radius: 8px; text-align: center;">
                        <p style="margin: 0; color: #64748b; font-size: 0.85em;">Task E</p>
                        <p id="inspector-stat-task-e" style="margin: 5px 0 0 0; font-size: 1.5em; font-weight: 700; color: #7c3aed;">-</p>
                    </div>
                </div>

                <!-- Message List -->
                <div id="inspector-message-list" style="background: white; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; margin-bottom: 20px;">
                    <div style="background: #f1f5f9; padding: 10px 15px; display: grid; grid-template-columns: 50px 200px 1fr 120px 100px; gap: 10px; font-weight: 600; color: #475569; font-size: 0.85em;">
                        <span>ID</span>
                        <span>Sender</span>
                        <span>Subject</span>
                        <span>Date</span>
                        <span>Status</span>
                    </div>
                    <div id="inspector-messages" style="max-height: 400px; overflow-y: auto;">
                        <div style="padding: 30px; text-align: center; color: #9ca3af;">Loading messages...</div>
                    </div>
                </div>

                <!-- Pagination -->
                <div id="inspector-pagination" style="display: flex; justify-content: center; gap: 10px; margin-bottom: 20px;">
                    <button id="inspector-prev" class="btn btn-secondary btn-small" onclick="inspectorPrevPage()" disabled>‚Üê Previous</button>
                    <span id="inspector-page-info" style="padding: 8px 15px; color: #64748b;">Page 1</span>
                    <button id="inspector-next" class="btn btn-secondary btn-small" onclick="inspectorNextPage()">Next ‚Üí</button>
                </div>

                <!-- Selected Message Detail -->
                <div id="inspector-detail" style="display: none; background: white; border: 2px solid #f59e0b; border-radius: 8px; overflow: hidden; margin-bottom: 20px;">
                    <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 15px 20px; border-bottom: 2px solid #f59e0b;">
                        <h3 style="margin: 0; color: #92400e;">Message Details</h3>
                    </div>

                    <!-- Two-column layout -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0;">
                        <!-- Left: Raw Message -->
                        <div style="padding: 20px; border-right: 1px solid #e5e7eb;">
                            <h4 style="margin: 0 0 15px 0; color: #374151; display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 1.2em;">üìß</span> Raw Email
                            </h4>
                            <div id="inspector-raw-message" style="font-size: 0.9em; line-height: 1.6;">
                                <!-- Raw message will be populated here -->
                            </div>
                        </div>

                        <!-- Right: Extractions -->
                        <div style="padding: 20px; background: #fafafa;">
                            <h4 style="margin: 0 0 15px 0; color: #374151; display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 1.2em;">üîç</span> LLM Extractions
                            </h4>
                            <div id="inspector-extractions" style="font-size: 0.9em;">
                                <!-- Extractions will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="button-group">
                    <button class="btn btn-secondary" onclick="goToPipeline()">‚Üê Back to Pipeline</button>
                    <button class="btn btn-primary" onclick="goToResults()">View Results ‚Üí</button>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>Sift - Email Intelligence Extraction | <span id="footer-version">v0.1.0</span></p>
    </footer>

    <!-- Scripts -->
    <script src="app.js"></script>
</body>
</html>
