{
  "prompt_id": "repl_code_gen_v1",
  "version": "1.1.0",
  "task": "repl_code_generation",
  "description": "Generates Python code to explore email corpus based on natural language questions. Part of REPL (Read-Eval-Print Loop) exploration feature.",
  "model_params": {
    "temperature": 0.1,
    "num_predict": 1000,
    "stop_sequences": []
  },
  "available_helpers": [
    "group_by_month(messages) -> Dict[str, List[Dict]]",
    "group_by_sender(messages) -> Dict[str, List[Dict]]",
    "group_by_project(messages) -> Dict[str, List[Dict]]",
    "filter_by_date_range(messages, start, end) -> List[Dict]",
    "filter_by_sender(messages, pattern) -> List[Dict]",
    "filter_by_project(messages, pattern) -> List[Dict]",
    "filter_by_subject(messages, pattern) -> List[Dict]",
    "filter_by_importance(messages, tier) -> List[Dict]",
    "filter_by_email_type(messages, type) -> List[Dict]",
    "filter_by_tone(messages, tone) -> List[Dict]",
    "filter_by_sentiment(messages, label) -> List[Dict]",
    "filter_by_sentiment_range(messages, min, max) -> List[Dict]",
    "filter_by_action_required(messages, required=True) -> List[Dict]",
    "filter_by_urgency(messages, urgency) -> List[Dict]",
    "filter_by_topic(messages, pattern) -> List[Dict]",
    "get_senders(messages) -> List[str]",
    "get_projects(messages) -> List[str]",
    "get_subjects(messages, limit=10) -> List[str]",
    "get_topics(messages) -> List[str]",
    "get_action_items(messages, limit=10) -> List[Dict]",
    "count_by_month(messages) -> Dict[str, int]",
    "count_by_sender(messages) -> Dict[str, int]",
    "count_by_project(messages) -> Dict[str, int]",
    "count_by_email_type(messages) -> Dict[str, int]",
    "count_by_tone(messages) -> Dict[str, int]",
    "count_by_sentiment(messages) -> Dict[str, int]",
    "count_by_topic(messages) -> Dict[str, int]",
    "avg_sentiment(messages) -> float",
    "summarize_message(msg) -> Dict",
    "summarize_messages(messages, limit=10) -> List[Dict]"
  ],
  "corpus_schema": {
    "id": "int - Message database ID",
    "subject": "str - Email subject line",
    "sender_email": "str - Sender email address",
    "sender_name": "str - Sender display name",
    "recipients": "str - Recipient list (comma-separated)",
    "cc": "str - CC list (comma-separated)",
    "date": "str - ISO date string",
    "date_obj": "datetime - Python datetime object",
    "month": "str - YYYY-MM format",
    "body": "str - Full email body",
    "body_snippet": "str - First 500 chars of body",
    "projects": "List[str] - Extracted project names",
    "stakeholders": "List[Dict] - Extracted stakeholders with name, role, confidence",
    "importance_tier": "str - Critical/Execution/Coordination/FYI/Noise",
    "is_meeting": "bool - Whether message is meeting-related",
    "summary": "str - 250 char summary of email content",
    "email_type": "str - request/update/decision/question/fyi/meeting/escalation/approval/handoff/social",
    "key_topics": "List[str] - Extracted topics/themes",
    "action_required": "bool - Whether recipient needs to take action",
    "urgency": "str - high/medium/low/none",
    "tone": "str - formal/casual/urgent/friendly/terse/diplomatic/frustrated/enthusiastic/neutral",
    "sentiment_score": "float - -1.0 (negative) to 1.0 (positive)",
    "sentiment_label": "str - positive/neutral/negative/mixed",
    "relationship_signals": "Dict - collaboration_level, power_dynamic, rapport_indicators"
  },
  "prompt_template": "You are a Python programmer exploring an email corpus to answer questions.\n\nThe variable `corpus` is a list of message dicts already loaded in memory.\n\n{helper_docs}\n\nCorpus stats: {corpus_stats}\n\nWrite Python code to answer this question. Assign the final answer to `result`.\nKeep code concise. Use helper functions when available.\nOnly output Python code, no markdown, no explanations.\n\nQuestion: {question}\n\nPython code:",
  "example_questions": [
    "How did my engagement with the Platform team change over Q4?",
    "Who were my top 5 collaborators in November?",
    "What projects went quiet in December?",
    "Show me a timeline of critical emails by month",
    "Which stakeholders appear across multiple projects?",
    "What's the average sentiment for emails about the migration project?",
    "Show me all urgent action items from this week",
    "Which senders have the most frustrated tone?",
    "What topics come up most in escalation emails?"
  ],
  "example_output": "platform_msgs = filter_by_project(corpus, 'platform')\nresult = count_by_month(platform_msgs)",
  "notes": [
    "Code executes in restricted sandbox with limited builtins",
    "Max 5 iterations to prevent infinite loops",
    "Output truncated at 10KB",
    "Model capability directly affects code quality - demonstrates MOE/parameter importance",
    "Task E fields (summary, tone, sentiment, etc.) may be null if enrichment hasn't run"
  ],
  "tags": ["repl", "code-generation", "exploration", "tech-demo"]
}
